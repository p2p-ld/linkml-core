# Repository Guidelines

## Project Structure & Module Organization
- `src/metamodel` (`linkml_meta`): Autogenerated metamodel types; optional Serde/PyO3.
- `src/schemaview` (`schemaview`/`linkml_schemaview`): Schema loading/resolution and views (SchemaView, ClassView, SlotView, EnumView).
- `src/runtime` (`linkml_runtime`): Core runtime (LinkMLInstance parse/validate, diff/patch, turtle). Pure Rust lib.
- `src/tools` (`linkml_tools`): CLI binaries: `linkml-validate`, `linkml-convert`, `linkml-diff`, `linkml-patch`, `linkml-schema-validate`.
- `src/python` (`linkml_runtime_python`): PyO3 bindings and Python package `linkml_runtime_rust._native` plus helpers.
- `src/wasm` (`linkml_wasm`): WASM build target.

## Build, Test, and Development Commands
- Build workspace: `cargo build --workspace`
- Run all tests: `cargo test --workspace`
- Format (check): `cargo +stable fmt --all -- --check` | Fix: `cargo +stable fmt --all`
- Lint: `cargo clippy -p schemaview -p linkml_runtime -p linkml_tools -p linkml_runtime_python -p linkml_wasm --all-targets --all-features -- -D warnings --no-deps` (excludes autogenerated `linkml_meta`)
- Run a CLI (example):
  - Validate: `cargo run -p linkml_tools --bin linkml-validate -- src/runtime/tests/data/schema.yaml Person src/runtime/tests/data/person_valid.yaml`
  - Convert to TTL: `cargo run -p linkml_tools --bin linkml-convert -- src/runtime/tests/data/schema.yaml src/runtime/tests/data/example_personinfo_data.yaml --class Person --output out.ttl`
  - Diff: `cargo run -p linkml_tools --bin linkml-diff -- src/runtime/tests/data/schema.yaml --class Person src/runtime/tests/data/person_older.yaml src/runtime/tests/data/person_valid.yaml`
- Python bindings: `maturin develop -m src/python/Cargo.toml` (requires Python and maturin).

## Coding Style & Naming Conventions
- Rust: 4-space indent; `snake_case` for functions/modules, `UpperCamelCase` for types, `SCREAMING_SNAKE_CASE` for consts.
- Use `rustfmt` and `clippy` before pushing. Keep public APIs documented with concise Rustdoc.
- Python (bindings helpers): follow PEP 8; prefer type hints where feasible.

## Testing Guidelines
- When testing locally, always provide network access. never try to run the tests offline
- Add integration tests under `src/runtime/tests/` when changing CLI/runtime behavior.
- Prefer `assert_cmd` for CLI and `predicates` for output checks. Keep fixtures in `src/runtime/tests/data/`.
- Run `cargo test --workspace` locally; ensure tests don’t rely on network input.
 - Prefer modifying existing tests over adding new ones for new code paths. Extend current scenarios with extra assertions/fixtures to avoid redundant tests proliferating. For example, if adding null-handling in diff/patch, enhance the existing diff tests rather than introducing separate "basic diff works" tests that become redundant.

## Commit & Pull Request Guidelines
- Commits: short, imperative summary (e.g., “Add __repr__ for LinkMLInstance”); group related changes.
- PRs: include clear description, rationale, and usage examples; link issues; update docs/tests; ensure CI passes: fmt, clippy (no warnings), and tests.

### Pre-commit checklist
- Run `cargo fmt --all` to format Rust code.
- Run `cargo clippy -p schemaview -p linkml_runtime -p linkml_tools -p linkml_runtime_python -p linkml_wasm --all-targets --all-features -- -D warnings --no-deps` and address all warnings (the generated `linkml_meta` crate is excluded).
- Run `cargo run -p linkml_runtime_python --bin stub_gen --features stubgen -- --check` to ensure Python stubs are current.

## Notes
- Network resolution is feature-gated; default builds include `resolve`. Only triggers when loading remote schemas.
